<!DOCTYPE html>
<html lang="ko">
<head>
  <title>ìš°ë¦¬íŒ€ ìš´ë™ í˜„í™©</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { max-width: 500px; margin: 40px auto; text-align: center; font-family: sans-serif; }
    h1 { color: #333; }
    #status { margin-top: 30px; border: 1px solid #eee; padding: 10px; border-radius: 8px; text-align: left; }
    .person { display: flex; justify-content: space-between; align-items: center; padding: 12px 5px; border-bottom: 1px solid #f0f0f0; }
    .person:last-child { border-bottom: none; }
    .name { font-size: 1.2em; font-weight: bold; }
    .controls button { font-size: 1.2em; width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ccc; background-color: white; cursor: pointer; }
    .count { font-size: 1.2em; margin: 0 15px; }
    #copy-button { font-size: 1em; padding: 10px 20px; margin-top: 20px; border-radius: 5px; background-color: #007bff; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ìš°ë¦¬íŒ€ ìš´ë™ í˜„í™© ğŸ’ª</h1>
  <div id="status"><h2>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2></div>
  <button id="copy-button" onclick="copyStatus()">í˜„í™© ë³µì‚¬í•˜ê¸°</button>

  <script>
    // 1ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ 'ë§ˆë²• ë§í¬' ì£¼ì†Œë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
    const API_URL = 'https://script.google.com/macros/s/AKfycby-odinzP1tpn03K4QNj6SHzGRvePZu2lEprhQIYkbyoPDSuPGfiSRSumDNZ5eBOJKH/exec';

    // í˜„ì¬ ì ìˆ˜íŒì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
    async function getStatus() {
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = '<h2>ìƒˆë¡œê³ ì¹¨ ì¤‘...</h2>';
      const response = await fetch(API_URL);
      const data = await response.json();
      let html = '';
      data.forEach(row => {
        const name = row[0];
        const count = row[1];
        html += `
          <div class="person">
            <span class="name">${name}</span>
            <div class="controls">
              <button onclick="recordWorkout('${name}', -1)">-</button>
              <span class="count">${count}</span>
              <button onclick="recordWorkout('${name}', 1)">+</button>
            </div>
          </div>
        `;
      });
      statusDiv.innerHTML = html;
    }

    // ìš´ë™ ê¸°ë¡ì„ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜ (+1 ë˜ëŠ” -1)
    async function recordWorkout(name, value) {
      // ë²„íŠ¼ ë¹„í™œì„±í™” (ì¤‘ë³µ í´ë¦­ ë°©ì§€)
      const buttons = document.querySelectorAll('.controls button');
      buttons.forEach(btn => btn.disabled = true);

      await fetch(API_URL, {
        method: 'POST',
        headers: {'Content-Type': 'text/plain;charset=utf-8'},
        body: JSON.stringify({ name: name, value: value }) // valueë„ í•¨ê»˜ ë³´ëƒ„
      });
      await getStatus(); // ê¸°ë¡ í›„ ì ìˆ˜íŒ ìƒˆë¡œê³ ì¹¨
    }

    // í˜„í™©ì„ í…ìŠ¤íŠ¸ë¡œ ë³µì‚¬í•˜ëŠ” í•¨ìˆ˜
    function copyStatus() {
      const statusDiv = document.getElementById('status');
      let textToCopy = "ğŸ”¥ ìš°ë¦¬íŒ€ ìš´ë™ í˜„í™© ğŸ”¥\n";
      statusDiv.querySelectorAll('.person').forEach(person => {
        const name = person.querySelector('.name').textContent;
        const count = person.querySelector('.count').textContent;
        textToCopy += `${name}: ${count}íšŒ\n`;
      });
      
      navigator.clipboard.writeText(textToCopy).then(() => {
        alert('í˜„í™©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      }).catch(err => {
        console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      });
    }

    // í˜ì´ì§€ê°€ ì—´ë¦¬ìë§ˆì ì ìˆ˜íŒì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
    getStatus();
  </script>
</body>
</html>