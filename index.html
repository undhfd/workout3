<!DOCTYPE html>
<html lang="ko">
<head>
  <title>ìš°ë¦¬íŒ€ ìš´ë™ í˜„í™©</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { max-width: 500px; margin: 40px auto; text-align: center; font-family: sans-serif; }
    h1 { color: #333; }
    #status { margin-top: 30px; border: 1px solid #eee; padding: 10px; border-radius: 8px; text-align: left; }
    .person { display: flex; justify-content: space-between; align-items: center; padding: 12px 5px; border-bottom: 1px solid #f0f0f0; }
    .person:last-child { border-bottom: none; }
    .name { font-size: 1.2em; font-weight: bold; }
    .controls button { font-size: 1.2em; width: 40px; height: 40px; border-radius: 50%; border: 1px solid #ccc; background-color: white; cursor: pointer; }
    .count { font-size: 1.2em; margin: 0 15px; }
    #copy-button { font-size: 1em; padding: 10px 20px; margin-top: 20px; border-radius: 5px; background-color: #007bff; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h1>ìš°ë¦¬íŒ€ ìš´ë™ í˜„í™© ğŸ’ª</h1>
  <div id="status"><h2>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2></div>
  <button id="copy-button" onclick="copyStatus()">í˜„í™© ë³µì‚¬í•˜ê¸°</button>

<script>
  // 1ë‹¨ê³„ì—ì„œ ë³µì‚¬í•œ 'ë§ˆë²• ë§í¬' ì£¼ì†Œë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
  const API_URL = 'https://script.google.com/macros/s/AKfycby-odinzP1tpn03K4QNj6SHzGRvePZu2lEprhQIYkbyoPDSuPGfiSRSumDNZ5eBOJKH/exec';

  // í˜„ì¬ ì ìˆ˜íŒì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
  async function getStatus() {
    const statusDiv = document.getElementById('status');
    statusDiv.innerHTML = '<h2>ìƒˆë¡œê³ ì¹¨ ì¤‘...</h2>';
    try {
      const response = await fetch(API_URL);
      const data = await response.json();
      let html = '';
      data.forEach(row => {
        const name = row[0];
        const count = row[1];
        html += `
          <div class="person">
            <span class="name">${name}</span>
            <div class="controls">
              <button onclick="recordWorkout(this, '${name}', -1)">-</button>
              <span class="count">${count}</span>
              <button onclick="recordWorkout(this, '${name}', 1)">+</button>
            </div>
          </div>
        `;
      });
      statusDiv.innerHTML = html;
    } catch (e) {
      statusDiv.innerHTML = '<h2>ë°ì´í„° ë¡œë”© ì‹¤íŒ¨!</h2>';
    }
  }

  // ã€ìˆ˜ì •ë¨ã€‘ ìš´ë™ ê¸°ë¡ì„ ìš”ì²­í•˜ëŠ” ìƒˆ í•¨ìˆ˜
  async function recordWorkout(buttonElement, name, value) {
    // 1. ì¦‰ì‹œ í™”ë©´ì˜ ìˆ«ì ë³€ê²½ (Optimistic UI)
    const controlsDiv = buttonElement.parentElement;
    const countSpan = controlsDiv.querySelector('.count');
    const currentCount = parseInt(countSpan.textContent);
    const newCount = currentCount + value;

    if (newCount < 0) return; // 0 ë¯¸ë§Œìœ¼ë¡œ ë‚´ë ¤ê°€ì§€ ì•Šë„ë¡ í•¨

    countSpan.textContent = newCount; // í™”ë©´ì— ì¦‰ì‹œ ë°˜ì˜

    // 2. ë³´ì´ì§€ ì•ŠëŠ” ê³³ì—ì„œ ì„œë²„ì— ì¡°ìš©íˆ ê¸°ë¡ ìš”ì²­
    try {
      await fetch(API_URL, {
        method: 'POST',
        headers: {'Content-Type': 'text/plain;charset=utf-8'},
        body: JSON.stringify({ name: name, value: value })
      });
      // ì„±ê³µí•˜ë©´ ì•„ë¬´ê²ƒë„ ì•ˆ í•¨. ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŒ
    } catch (e) {
      console.error("ê¸°ë¡ ì‹¤íŒ¨:", e);
      // ì‹¤íŒ¨ ì‹œ ì›ë˜ ìˆ«ìë¡œ ë˜ëŒë¦¬ëŠ” ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      countSpan.textContent = currentCount; 
      alert("ê¸°ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
    }
  }

  // í˜„í™©ì„ í…ìŠ¤íŠ¸ë¡œ ë³µì‚¬í•˜ëŠ” í•¨ìˆ˜
  function copyStatus() {
    const statusDiv = document.getElementById('status');
    let textToCopy = "ğŸ”¥ ìš°ë¦¬íŒ€ ìš´ë™ í˜„í™© ğŸ”¥\n";
    statusDiv.querySelectorAll('.person').forEach(person => {
      const name = person.querySelector('.name').textContent;
      const count = person.querySelector('.count').textContent;
      textToCopy += `${name}: ${count}íšŒ\n`;
    });
    navigator.clipboard.writeText(textToCopy).then(() => {
      alert('í˜„í™©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    });
  }

  // í˜ì´ì§€ê°€ ì—´ë¦¬ìë§ˆì ì ìˆ˜íŒì„ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
  getStatus();
</script>
</body>
</html>